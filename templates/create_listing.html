{% extends "base.html" %}

{% block title %}Create Listing - {{ initial_data.issue_key }}{% endblock %}

{% block content %}
<a href="{{ url_for('jira_tasks') }}" class="back-link">‚Üê Back to JIRA Tasks</a>

<div class="card">
    <h1>Create Listing from JIRA</h1>
    
    <div class="jira-reference">
        <strong>JIRA Issue:</strong> 
        <a href="{{ initial_data.issue_url }}" target="_blank" class="badge badge-jira">
            {{ initial_data.issue_key }}
        </a>
        <p class="text-muted mt-2">{{ initial_data.title }}</p>
    </div>

    <form method="post" enctype="multipart/form-data" class="listing-form">
        <div class="form-group">
            <label for="title">Title *</label>
            <input type="text" 
                   id="title" 
                   name="title" 
                   class="form-control" 
                   value="{{ initial_data.title }}"
                   required>
            <small class="form-text">Brief descriptive title for the listing</small>
        </div>

        <div class="form-group">
            <label for="condition">Condition *</label>
            <select id="condition" name="condition" class="form-control" required>
                <option value="">Select condition...</option>
                <option value="New">New</option>
                <option value="Like New">Like New</option>
                <option value="Excellent">Excellent</option>
                <option value="Good">Good</option>
                <option value="Fair">Fair</option>
                <option value="For Parts">For Parts</option>
            </select>
        </div>

        <div class="form-group">
            <label for="measurements">Measurements</label>
            <input type="text" 
                   id="measurements" 
                   name="measurements" 
                   class="form-control"
                   placeholder='e.g., 72" L x 36" W x 30" H'>
            <small class="form-text">Dimensions or size information</small>
        </div>

        <div class="form-group">
            <label for="category">Category</label>
            <input type="text" 
                   id="category" 
                   name="category" 
                   class="form-control"
                   placeholder="e.g., Furniture, Electronics, Tools">
        </div>

        <div class="form-group">
            <label for="images">Upload Images</label>
            <input type="file" 
                   id="images" 
                   name="images" 
                   class="form-control" 
                   multiple
                   accept="image/png,image/jpeg,image/jpg,image/gif,image/webp">
            <small class="form-text">Select multiple images (PNG, JPG, GIF, WebP - Max 10MB each)</small>
            <div id="preview" class="image-preview-grid"></div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-lg">Create Listing</button>
            <a href="{{ url_for('jira_tasks') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
// Image preview
document.getElementById('images').addEventListener('change', function(e) {
    const preview = document.getElementById('preview');
    preview.innerHTML = '';
    
    Array.from(e.target.files).forEach(file => {
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const div = document.createElement('div');
                div.className = 'image-preview-item';
                div.innerHTML = `
                    <img src="${e.target.result}" alt="${file.name}">
                    <small>${file.name}</small>
                `;
                preview.appendChild(div);
            };
            reader.readAsDataURL(file);
        }
    });
});
</script>
{% endblock %}
